p8105_hw5_zlb2008
================
Zakari L. Billo
2025-11-09

## Problem 1

``` r
set.seed(1)

bday_match <- function(n) {
  
  birthdays <- sample(1:365, size =  n, replace = TRUE)
  
  return(any(duplicated(birthdays)))
}
```

``` r
n_sims <- 10000
group_sizes <- 2:50

probabilities <- sapply(group_sizes, function(n) {
  
    sim_results <- replicate(n_sims, bday_match(n))
    
    mean(sim_results)
    
})

results_df <- data.frame(
  n = group_sizes,
  probability = probabilities
  ) 

results_df |>
  ggplot(aes(x = n, y = probability)) +
  geom_line(color = "blue", linewidth = 1) +
  geom_point(color = "blue") +
  labs(
    title = "Birthday Problem Simulation",
    x = "Group Size (n)",
    y = "Probability of at least one shared birthday"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal() |>
  print()
```

    ## List of 136
    ##  $ line                            :List of 6
    ##   ..$ colour       : chr "black"
    ##   ..$ linewidth    : num 0.5
    ##   ..$ linetype     : num 1
    ##   ..$ lineend      : chr "butt"
    ##   ..$ arrow        : logi FALSE
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_line" "element"
    ##  $ rect                            :List of 5
    ##   ..$ fill         : chr "white"
    ##   ..$ colour       : chr "black"
    ##   ..$ linewidth    : num 0.5
    ##   ..$ linetype     : num 1
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_rect" "element"
    ##  $ text                            :List of 11
    ##   ..$ family       : chr ""
    ##   ..$ face         : chr "plain"
    ##   ..$ colour       : chr "black"
    ##   ..$ size         : num 11
    ##   ..$ hjust        : num 0.5
    ##   ..$ vjust        : num 0.5
    ##   ..$ angle        : num 0
    ##   ..$ lineheight   : num 0.9
    ##   ..$ margin       : 'margin' num [1:4] 0points 0points 0points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : logi FALSE
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ title                           : NULL
    ##  $ aspect.ratio                    : NULL
    ##  $ axis.title                      : NULL
    ##  $ axis.title.x                    :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 1
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 2.75points 0points 0points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.title.x.top                :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 0
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 0points 2.75points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.title.x.bottom             : NULL
    ##  $ axis.title.y                    :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 1
    ##   ..$ angle        : num 90
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 2.75points 0points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.title.y.left               : NULL
    ##  $ axis.title.y.right              :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 1
    ##   ..$ angle        : num -90
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.75points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text                       :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : chr "grey30"
    ##   ..$ size         : 'rel' num 0.8
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : NULL
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text.x                     :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 1
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 2.2points 0points 0points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text.x.top                 :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : num 0
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 0points 2.2points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text.x.bottom              : NULL
    ##  $ axis.text.y                     :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : num 1
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 0points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text.y.left                : NULL
    ##  $ axis.text.y.right               :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : num 0
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 0points 0points 2.2points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.text.theta                 : NULL
    ##  $ axis.text.r                     :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : num 0.5
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : 'margin' num [1:4] 0points 2.2points 0points 2.2points
    ##   .. ..- attr(*, "unit")= int 8
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ axis.ticks                      : list()
    ##   ..- attr(*, "class")= chr [1:2] "element_blank" "element"
    ##  $ axis.ticks.x                    : NULL
    ##  $ axis.ticks.x.top                : NULL
    ##  $ axis.ticks.x.bottom             : NULL
    ##  $ axis.ticks.y                    : NULL
    ##  $ axis.ticks.y.left               : NULL
    ##  $ axis.ticks.y.right              : NULL
    ##  $ axis.ticks.theta                : NULL
    ##  $ axis.ticks.r                    : NULL
    ##  $ axis.minor.ticks.x.top          : NULL
    ##  $ axis.minor.ticks.x.bottom       : NULL
    ##  $ axis.minor.ticks.y.left         : NULL
    ##  $ axis.minor.ticks.y.right        : NULL
    ##  $ axis.minor.ticks.theta          : NULL
    ##  $ axis.minor.ticks.r              : NULL
    ##  $ axis.ticks.length               : 'simpleUnit' num 2.75points
    ##   ..- attr(*, "unit")= int 8
    ##  $ axis.ticks.length.x             : NULL
    ##  $ axis.ticks.length.x.top         : NULL
    ##  $ axis.ticks.length.x.bottom      : NULL
    ##  $ axis.ticks.length.y             : NULL
    ##  $ axis.ticks.length.y.left        : NULL
    ##  $ axis.ticks.length.y.right       : NULL
    ##  $ axis.ticks.length.theta         : NULL
    ##  $ axis.ticks.length.r             : NULL
    ##  $ axis.minor.ticks.length         : 'rel' num 0.75
    ##  $ axis.minor.ticks.length.x       : NULL
    ##  $ axis.minor.ticks.length.x.top   : NULL
    ##  $ axis.minor.ticks.length.x.bottom: NULL
    ##  $ axis.minor.ticks.length.y       : NULL
    ##  $ axis.minor.ticks.length.y.left  : NULL
    ##  $ axis.minor.ticks.length.y.right : NULL
    ##  $ axis.minor.ticks.length.theta   : NULL
    ##  $ axis.minor.ticks.length.r       : NULL
    ##  $ axis.line                       : list()
    ##   ..- attr(*, "class")= chr [1:2] "element_blank" "element"
    ##  $ axis.line.x                     : NULL
    ##  $ axis.line.x.top                 : NULL
    ##  $ axis.line.x.bottom              : NULL
    ##  $ axis.line.y                     : NULL
    ##  $ axis.line.y.left                : NULL
    ##  $ axis.line.y.right               : NULL
    ##  $ axis.line.theta                 : NULL
    ##  $ axis.line.r                     : NULL
    ##  $ legend.background               : list()
    ##   ..- attr(*, "class")= chr [1:2] "element_blank" "element"
    ##  $ legend.margin                   : 'margin' num [1:4] 5.5points 5.5points 5.5points 5.5points
    ##   ..- attr(*, "unit")= int 8
    ##  $ legend.spacing                  : 'simpleUnit' num 11points
    ##   ..- attr(*, "unit")= int 8
    ##  $ legend.spacing.x                : NULL
    ##  $ legend.spacing.y                : NULL
    ##  $ legend.key                      : list()
    ##   ..- attr(*, "class")= chr [1:2] "element_blank" "element"
    ##  $ legend.key.size                 : 'simpleUnit' num 1.2lines
    ##   ..- attr(*, "unit")= int 3
    ##  $ legend.key.height               : NULL
    ##  $ legend.key.width                : NULL
    ##  $ legend.key.spacing              : 'simpleUnit' num 5.5points
    ##   ..- attr(*, "unit")= int 8
    ##  $ legend.key.spacing.x            : NULL
    ##  $ legend.key.spacing.y            : NULL
    ##  $ legend.frame                    : NULL
    ##  $ legend.ticks                    : NULL
    ##  $ legend.ticks.length             : 'rel' num 0.2
    ##  $ legend.axis.line                : NULL
    ##  $ legend.text                     :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : 'rel' num 0.8
    ##   ..$ hjust        : NULL
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : NULL
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ legend.text.position            : NULL
    ##  $ legend.title                    :List of 11
    ##   ..$ family       : NULL
    ##   ..$ face         : NULL
    ##   ..$ colour       : NULL
    ##   ..$ size         : NULL
    ##   ..$ hjust        : num 0
    ##   ..$ vjust        : NULL
    ##   ..$ angle        : NULL
    ##   ..$ lineheight   : NULL
    ##   ..$ margin       : NULL
    ##   ..$ debug        : NULL
    ##   ..$ inherit.blank: logi TRUE
    ##   ..- attr(*, "class")= chr [1:2] "element_text" "element"
    ##  $ legend.title.position           : NULL
    ##  $ legend.position                 : chr "right"
    ##  $ legend.position.inside          : NULL
    ##  $ legend.direction                : NULL
    ##  $ legend.byrow                    : NULL
    ##  $ legend.justification            : chr "center"
    ##  $ legend.justification.top        : NULL
    ##  $ legend.justification.bottom     : NULL
    ##  $ legend.justification.left       : NULL
    ##  $ legend.justification.right      : NULL
    ##  $ legend.justification.inside     : NULL
    ##  $ legend.location                 : NULL
    ##  $ legend.box                      : NULL
    ##  $ legend.box.just                 : NULL
    ##  $ legend.box.margin               : 'margin' num [1:4] 0cm 0cm 0cm 0cm
    ##   ..- attr(*, "unit")= int 1
    ##  $ legend.box.background           : list()
    ##   ..- attr(*, "class")= chr [1:2] "element_blank" "element"
    ##  $ legend.box.spacing              : 'simpleUnit' num 11points
    ##   ..- attr(*, "unit")= int 8
    ##   [list output truncated]
    ##  - attr(*, "class")= chr [1:2] "theme" "gg"
    ##  - attr(*, "complete")= logi TRUE
    ##  - attr(*, "validate")= logi TRUE

<img src="p8105_hw5_zlb2008_files/figure-gfm/unnamed-chunk-2-1.png" width="90%" style="display: block; margin: auto;" />

The probability of a shared birhtday appears to be a positive monotinic
function of group size. At a group sizes 23 and 50 there is a 51.30% and
97.03% chance of at least one shared birthday, respectively. The growth
is rapid because we aren’t checking for a match with a specific birthday
or birthdate. Instead, we are checking for any match between any two
people in the group.

## Problem 2

``` r
set.seed(1)
n = 30
mus_to_test = 0:6 
sigma = 5
n_sims = 5000
alpha = 0.05

sim_results <- crossing(
  true_mu = mus_to_test,
  sim_id = 1:n_sims
  ) |>
  mutate(test_result = map(true_mu, ~ {
    
    sim_data_vector = rnorm(n, mean = .x, sd = sigma)
    
    broom::tidy(t.test(sim_data_vector, mu = 0))
  })) |>
  unnest(test_result)

sim_results |>
  select(
    true_mu,
    mu_hat = estimate, 
    p_value = p.value
  ) |>
  knitr::kable(digits = 3) |>
  head(10)
```

    ##  [1] "| true_mu| mu_hat| p_value|" "|-------:|------:|-------:|"
    ##  [3] "|       0|  0.412|   0.629|" "|       0|  0.664|   0.368|"
    ##  [5] "|       0|  0.551|   0.534|" "|       0|  0.567|   0.487|"
    ##  [7] "|       0| -1.650|   0.060|" "|       0|  1.185|   0.229|"
    ##  [9] "|       0|  0.334|   0.738|" "|       0| -1.190|   0.209|"

``` r
sim_results |>
  group_by(true_mu) |>
  summarize(
    proportion_rejected = mean(p.value < alpha),
    .groups = "drop" 
  ) |> 
  ggplot(aes(x = true_mu, y = proportion_rejected)) +
  geom_line(color = "blue", linewidth =  1) +
  geom_point(color = "blue", linewidth =  3) +
  geom_hline(yintercept = alpha, linetype = "dashed", color = "red") +
  annotate("text", x = 0.5, y = 0.07, label = "Type I Error Rate (α = 0.05)",
           hjust = 0, color = "red") +
  labs(
    title = "Power & Type I Error by True Value of μ (n=30, σ=5)",
    subtitle = "H0: μ = 0  |  5,000 simulations per point",
    x = "True Value of μ",
    y = "Proportion of times H0 was rejected"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal()
```

    ## Warning in geom_point(color = "blue", linewidth = 3): Ignoring unknown
    ## parameters: `linewidth`

<img src="p8105_hw5_zlb2008_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" style="display: block; margin: auto;" />

As effect size increases, power also increases. The fact that $H_0$ was
rejected approximately 5% of times when the true value of $\mu$ is 0
confirms that $alpha$ is appropriately limiting the type 1 errors at the
0.05 threshhold. These results indicate the t test is working correctly
for the simulation.

``` r
sim_results |>
  group_by(true_mu) |>
  summarize(
    `All Samples` = mean(estimate),
    `Rejected Samples Only` = mean(estimate[p.value < alpha]),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols = c(`All Samples`, `Rejected Samples Only`),
    names_to = "group",
    values_to = "avg_mu_hat"
  ) |>
  ggplot(aes(x = true_mu, y = avg_mu_hat, color = group)) +
  geom_line(aes(linetype = group), linewidth =  1) +
  geom_point(aes(shape = group), linewidth =  3) +
  geom_abline(slope = 1, intercept = 0, linetype = "dotted", color = "black") +
  annotate("text", x = 1.3, y = 1.1, label = "y = x (Identity Line)", 
           hjust = 0, vjust = 0, linewidth =  3, color = "black") +
  labs(
    title = "Average μ Estimate vs. True μ",
    subtitle = "Comparing all samples vs. only 'significant' (p < 0.05) samples",
    x = "True Value of μ",
    y = "Average μ Estimat)",
    color = "Sample Group",
    linetype = "Sample Group",
    shape = "Sample Group"
  ) +
  theme_minimal() +
  scale_color_manual(values = c("All Samples" = "blue", "Rejected Samples Only" = "red"))
```

    ## Warning in geom_point(aes(shape = group), linewidth = 3): Ignoring unknown
    ## parameters: `linewidth`

    ## Warning in annotate("text", x = 1.3, y = 1.1, label = "y = x (Identity Line)",
    ## : Ignoring unknown parameters: `linewidth`

<img src="p8105_hw5_zlb2008_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" style="display: block; margin: auto;" />

The sample average of $\hat{\mu}$ across tests for which the null is
rejected is not approximately equal to the true value of $\mu$,
particularly between $0 < \mu < 3$. This is because low effect sizes
worsen power, and produces selection bias. Filtering for $p < 0.05$
effectively captures overestimates, where the sample of 30 people
produces a sample mean $\hat{\mu}$ that is unusually larger than the
true mean. However, as $mu$ gets larger, the power approaches 100%, and
the average $\hat{\mu}$ for the “rejected” group converges with the true
$\mu$ and the average for the “All Samples” group.

## Problem 3

``` r
homicide_df <- read.csv('data/homicide-data.csv', na = c("NA", ".", "")) |>
  janitor::clean_names() 

summary(homicide_df)
```

    ##      uid            reported_date       victim_last        victim_first      
    ##  Length:52179       Min.   : 20070101   Length:52179       Length:52179      
    ##  Class :character   1st Qu.: 20100318   Class :character   Class :character  
    ##  Mode  :character   Median : 20121216   Mode  :character   Mode  :character  
    ##                     Mean   : 20130899                                        
    ##                     3rd Qu.: 20150911                                        
    ##                     Max.   :201511105                                        
    ##                                                                              
    ##  victim_race         victim_age         victim_sex            city          
    ##  Length:52179       Length:52179       Length:52179       Length:52179      
    ##  Class :character   Class :character   Class :character   Class :character  
    ##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
    ##                                                                             
    ##                                                                             
    ##                                                                             
    ##                                                                             
    ##     state                lat             lon          disposition       
    ##  Length:52179       Min.   :25.73   Min.   :-122.51   Length:52179      
    ##  Class :character   1st Qu.:33.77   1st Qu.: -96.00   Class :character  
    ##  Mode  :character   Median :38.52   Median : -87.71   Mode  :character  
    ##                     Mean   :37.03   Mean   : -91.47                     
    ##                     3rd Qu.:40.03   3rd Qu.: -81.76                     
    ##                     Max.   :45.05   Max.   : -71.01                     
    ##                     NA's   :60      NA's   :60

The raw data has 52179 observations, corresponding to homicides, across
12 variables: `uid`, `reported_date`, `victim_last`, `victim_first`,
`victim_race`, `victim_age`, `victim_sex`, `city`, `state`, `lat`,
`lon`, `disposition`. There are 120 NAs split evenly between `lat` and
`lon`.

``` r
homicide_df <- homicide_df |>
  unite(
    col = "city_state", 
    city, state,  
    sep = ", ",    
    remove = TRUE   
  ) 

homicide_df |> 
  group_by(city_state) |>
  summarize(
    total_homicides = n(),
    unsolved_closed_without = sum(disposition == "Closed without arrest"),
    unsolved_open = sum(disposition == "Open/No arrest"),
    .groups = "drop" 
  ) |>
  knitr::kable(
    caption = "Homicide Counts by City and Disposition",
    col.names = c("City-State", "Total Homicides", 
                  "Closed without Arrest", "Open/No Arrest")
  )
```

| City-State         | Total Homicides | Closed without Arrest | Open/No Arrest |
|:-------------------|----------------:|----------------------:|---------------:|
| Albuquerque, NM    |             378 |                    52 |             94 |
| Atlanta, GA        |             973 |                    58 |            315 |
| Baltimore, MD      |            2827 |                   152 |           1673 |
| Baton Rouge, LA    |             424 |                    16 |            180 |
| Birmingham, AL     |             800 |                    64 |            283 |
| Boston, MA         |             614 |                     0 |            310 |
| Buffalo, NY        |             521 |                     8 |            311 |
| Charlotte, NC      |             687 |                    44 |            162 |
| Chicago, IL        |            5535 |                   387 |           3686 |
| Cincinnati, OH     |             694 |                    49 |            260 |
| Columbus, OH       |            1084 |                    80 |            495 |
| Dallas, TX         |            1567 |                    78 |            676 |
| Denver, CO         |             312 |                    46 |            123 |
| Detroit, MI        |            2519 |                    16 |           1466 |
| Durham, NC         |             276 |                    11 |             90 |
| Fort Worth, TX     |             549 |                    35 |            220 |
| Fresno, CA         |             487 |                    23 |            146 |
| Houston, TX        |            2942 |                   346 |           1147 |
| Indianapolis, IN   |            1322 |                   102 |            492 |
| Jacksonville, FL   |            1168 |                   141 |            456 |
| Kansas City, MO    |            1190 |                    36 |            450 |
| Las Vegas, NV      |            1381 |                   175 |            397 |
| Long Beach, CA     |             378 |                    27 |            129 |
| Los Angeles, CA    |            2257 |                     0 |           1106 |
| Louisville, KY     |             576 |                     0 |            261 |
| Memphis, TN        |            1514 |                    50 |            433 |
| Miami, FL          |             744 |                    63 |            387 |
| Milwaukee, wI      |            1115 |                    37 |            366 |
| Minneapolis, MN    |             366 |                    31 |            156 |
| Nashville, TN      |             767 |                    57 |            221 |
| New Orleans, LA    |            1434 |                    98 |            832 |
| New York, NY       |             627 |                    17 |            226 |
| Oakland, CA        |             947 |                     0 |            508 |
| Oklahoma City, OK  |             672 |                    11 |            315 |
| Omaha, NE          |             409 |                    10 |            159 |
| Philadelphia, PA   |            3037 |                    92 |           1268 |
| Phoenix, AZ        |             914 |                    96 |            408 |
| Pittsburgh, PA     |             631 |                     0 |            337 |
| Richmond, VA       |             429 |                    20 |             93 |
| Sacramento, CA     |             376 |                    23 |            116 |
| San Antonio, TX    |             833 |                    87 |            270 |
| San Bernardino, CA |             275 |                    19 |            151 |
| San Diego, CA      |             461 |                    64 |            111 |
| San Francisco, CA  |             663 |                     1 |            335 |
| Savannah, GA       |             246 |                    12 |            103 |
| St. Louis, MO      |            1677 |                    40 |            865 |
| Stockton, CA       |             444 |                    11 |            255 |
| Tampa, FL          |             208 |                     8 |             87 |
| Tulsa, AL          |               1 |                     0 |              0 |
| Tulsa, OK          |             583 |                    55 |            138 |
| Washington, DC     |            1345 |                    74 |            515 |

Homicide Counts by City and Disposition

``` r
homicide_df |>
  filter(city_state == "Baltimore, MD") |>
  mutate(
    unsolved = ifelse(disposition %in% c("Closed without arrest", "Open/No arrest"), 1, 0)
  ) |>
  summarize(
    unsolved_count = sum(unsolved, na.rm = TRUE),
    total_count = n()  
  ) |>
  reframe(
    broom::tidy(prop.test(unsolved_count, total_count))
  ) |>
  select(estimate, conf.low, conf.high)
```

    ##    estimate  conf.low conf.high
    ## 1 0.6455607 0.6275625 0.6631599

``` r
get_city_prop_tests <- function(data) {
  data |>
    mutate(
      unsolved = ifelse(disposition %in% c("Closed without arrest", "Open/No arrest"), 1, 0)
    ) |>
    group_by(city_state) %>%
    summarize(
      unsolved_count = sum(unsolved, na.rm = TRUE),
      total_count = n(),
      .groups = "drop"
    ) |>
    mutate(test = map2(unsolved_count, total_count, ~ prop.test(.x, .y)),
           tidy = map(test, broom::tidy)) %>%
    unnest(tidy) |>
    select(city_state, estimate, conf.low, conf.high)
}

city_prop_tests <- get_city_prop_tests(homicide_df)
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `test = map2(unsolved_count, total_count, ~prop.test(.x, .y))`.
    ## Caused by warning in `prop.test()`:
    ## ! Chi-squared approximation may be incorrect

``` r
print(city_prop_tests)
```

    ## # A tibble: 51 × 4
    ##    city_state      estimate conf.low conf.high
    ##    <chr>              <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    0.386    0.337     0.438
    ##  2 Atlanta, GA        0.383    0.353     0.415
    ##  3 Baltimore, MD      0.646    0.628     0.663
    ##  4 Baton Rouge, LA    0.462    0.414     0.511
    ##  5 Birmingham, AL     0.434    0.399     0.469
    ##  6 Boston, MA         0.505    0.465     0.545
    ##  7 Buffalo, NY        0.612    0.569     0.654
    ##  8 Charlotte, NC      0.300    0.266     0.336
    ##  9 Chicago, IL        0.736    0.724     0.747
    ## 10 Cincinnati, OH     0.445    0.408     0.483
    ## # ℹ 41 more rows

``` r
city_prop_tests |>
  mutate(city_state = reorder(city_state, estimate)
  ) |>
  ggplot(aes(x = city_state, y = estimate)) +
  geom_col(fill = "lightpink") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.3) +
  coord_flip() +
  labs(
    x = "City",
    y = "Prop. Unsolved Homocides",
    title = "Proportion of Unsolved Homicides by City (95% CI)",
  ) +
  theme_minimal(base_size = 14)
```

<img src="p8105_hw5_zlb2008_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" style="display: block; margin: auto;" />
